---
title: "Encuestas Sociales"
author: ".small[Juan Carlos Castillo <br><br> Departamento de Sociología - UCH / COES <br><br>]"
date: "1er Sem 2022"
output:
   xaringan::moon_reader:
    css: "../../files/css/custom_2020.css"
    includes:
      after_body: "../insert-logo.html"
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "https://multinivel.netlify.com/docpres/xaringan_custom/macros.js"
    seal: false # esto omite title slide automática
---
class: front

```{r eval=FALSE, include=FALSE}
# Correr esto para que funcione el infinite moonreader, el root folder debe ser static para si dirigir solo "bajndo" en directorios hacia el bib y otros

xaringan::inf_mr('/static/docpres/02_bases/2mlmbases.Rmd')

o en RStudio:
  - abrir desde carpeta root del proyecto
  - Addins-> infinite moon reader
```


```{r setup, include=FALSE, cache = FALSE}
#require("knitr")
library(rmarkdown)
options(htmltools.dir.version = FALSE)
#pacman::p_load(RefManageR)
# bib <- ReadBib("../../bib/electivomultinivel.bib", check = FALSE)
#opts_chunk$set(warning=FALSE,
#             message=FALSE,
#             echo=TRUE,
#             cache = FALSE, fig.width=7, fig.height=5.2)
# pacman::p_load(flipbookr, tidyverse)


```


```{r xaringanExtra, include=FALSE}
xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css"))
xaringanExtra::use_scribble()
#xaringanExtra::use_share_again()
#xaringanExtra::style_share_again(
#  share_buttons = "none",
#  )
```

<!---
Para correr en ATOM
- open terminal, abrir R (simplemente, R y enter)
- rmarkdown::render('static/docpres/07_interacciones/7interacciones.Rmd', 'xaringan::moon_reader')

About macros.js: permite escalar las imágenes como [scale 50%](path to image), hay si que grabar ese archivo js en el directorio.
--->


.pull-left[
# Encuestas Sociales
## Juan Carlos Castillo
## Sociología FACSO - UChile
## 2do Sem 2022
## [.green[encuestas-sociales.netlify.com]](https://encuestas-sociales.netlify.com)
]


.pull-right[
.right[
<br>
## .yellow[Sesión 11: Análisis factorial]
![:scale 70%](../../files/img/eval-hires.png)

]
]

---

layout: true
class: animated, fadeIn

---

class: inverse bottom right

## .red[De la clase anterior ...]

---


.center[
![:scale 40%](../../files/img/slides/peras-manzanas.png)
]

---

class: middle

.pull-left-narrow[
# Preguntas y error de medición
]
.pull-right-wide[
.content-box-yellow[
-   Para medir hechos observables simples usualmente se utiliza **una
    pregunta** (ej: edad)

-   Fenómenos complejos se miden en general con más de una pregunta, con el objetivo de dar mejor cuenta del atributo (i.e. minimizar .red[error de medición])
]]

---
class: middle

.pull-left-narrow[
# Preguntas y error de medición
]

.pull-right-wide[
.content-box-red[
-   En este marco se asume que el **indicador es distinto del atributo**, y que la medición del atributo o variable latente conlleva error

-   Cuando la el atributo se mide con más de una pregunta, se puede
    intentar estimar la **variable latente** mediante índices o           técnicas de **análisis factorial**
]]

---
# Construcción de índices

- análisis descriptivo de items (ej: plot_stackfrq de sjPlot)

- matriz de correlaciones (ej: con `corrplot`)

- cálculo de consistencia interna (Alpha de Cronbach)

- cálculo de índice promedio (atendiendo casos perdidos)

---
class: inverse bottom right

# .red[Esta clase: Análisis factorial]


---

class: middle

.pull-left-narrow[
#  Variables latentes (1)
]

.pull-right-wide[

.content-box-red[
-   La mayor parte de las variables en el mundo social no son
    directamente observables. Esto las hace constructos hipotéticos **latentes**
    
-   La medición de variables latentes se realiza a partir de indicadores observables, tales como los .red[ítems de una batería/ cuestionario]
]
]
---
class: middle

.pull-left-narrow[
#  Variables latentes (2)
]
.pull-right-wide[
.content-box-yellow[
-   Lo latente puede ser entendido como la .red[varianza compartida] por
    diferentes indicadores observados

-   La medición de variables latentes se encuentra asociada al .red[modelo de factor común] (Thurstone) y al análisis factorial
]
]
---
# Factor común

.pull-left[
-   Cada indicador en un set de medidas observadas es una .red[función lineal]de uno o más factores comunes y un factor único

-   Como referencia podemos usar la .red[teoría clásica de test] (CTT), que
    divide el puntaje de los indicadores entre puntaje verdadero y error
    ]

--

.pull-right[
<br>
$$X=T+E$$

$$\sigma^{2}_{x}=\sigma^{2}_{t} + \sigma^{2}_{e}$$

Donde
- X= puntaje observado,
- T= puntaje verdadero, y
- E= error

]
---
# Modelo de factor común

.pull-left[
-   La existencia de un solo ítem por constructo no permite aislar puntaje verdadero del error

-   Si existen más ítems, el **análisis factorial** y
    distinguir entre **varianza común** (compartida con otros indicadores) y **varianza única** (o error)
]

.pull-right[
.center[
  ![](../../files/img/slides/figure1efa.jpg)
]
]
---
# Análisis factorial

Es un método que permite:

- identificar la varianza común a una serie de indicadores

- establecer la contribución de cada indicador a la varianza común

- estimar posteriormente un índice (puntaje factorial) para cada factor, con mayor precisión que un promedio bruto

---
# Análisis factorial

-   Un factor es una variable no observada o **latente** que da cuenta de las correlaciones entre indicadores 
    
- los indicadores están correlacionados porque comparten una causa común - concepto de **independencia condicional**

-   El o los factores darían cuenta (i.e. causarían) de la **covariación** entre una serie de medidas observadas (indicadores)

---
.content-box-red[
# Objetivos del análisis factorial
]
-   .red[Teórico]: relacionar datos con dimensiones latentes basadas en conceptos (validez de constructo)

-   .blue[Pragmático]: hacer sentido de un conjunto de datos, reducción de
    dimensiones y obtención de puntajes

-   .green[Metodológico]: aislar el error (varianza única) de la varianza común


---
# Alternativas en análisis factorial

-   .red[exploratorio (EFA)]: Permite explorar las dimensiones que subyacen a una escala

-   .red[confirmatorio (CFA)]: Permite confirmar las dimensiones que subyacen a una escala, aislando el error de medición en la estimación

---
# Análisis factorial exploratorio (EFA)

-   Forma de análisis factorial donde se estiman la o las variables
    latentes a un conjunto de indicadores, **sin una especificación previa** de la estructura factorial.

-   Preguntas a responder:

    -   ¿Cuántos factores subyacen a un conjunto de indicadores?

    -   ¿Cómo se relacionan los indicadores con los factores?

    -   ¿Cómo es la calidad del modelo estimado?



---
.content-box-green[
# Características EFA
]

.pull-left-narrow[

.center[
<br>
  ![](../../files/img/slides/figure1efa.jpg)
]]
.pull-right-wide[
-   Basado en la matriz de correlaciones

- Modelo estandarizado (varianza factores=1)

-   Diferentes métodos de extracción de factores

-   Determinación del número y "calidad" de las dimensiones (continuas) subyacentes a una escala

]


---
# Ejemplo Brown 2006 (Chap.2)

.center[

![:scale 50%](../../files/img/slides/brown_cormat.png)
]

---
## Ejemplo Brown 2006 (Chap.2)

.center[

![](../../files/img/slides/brown_diag.png)

]


---
# Modelo estadístico

$$y_{j}= \lambda_{j1} \eta_{1} + \lambda_{j2} \eta_{2} + ... + \lambda_{jm} \eta_{m} + \varepsilon_{j}$$

_Donde_

-   $\eta$ : factor

-   $\lambda_{jm}$ : carga factorial que relaciona al
    indicador *j* con el factor $\eta$

-   $\varepsilon_{j}$ : varianza que es única al indicador
    $y_{j}$


---

... aplicado al ejemplo de Brown 2006:

- $D1=\lambda_{11}\eta_{1} + \varepsilon_{1}$
- $D2=\lambda_{21}\eta_{1} + \varepsilon_{2}$
- $D3=\lambda_{31}\eta_{1} + \varepsilon_{3}$
- $D4=\lambda_{41}\eta_{1} + \varepsilon_{4}$

---
# Aplicado al ejemplo de Brown 2006:

Reproduccion de matriz de correlaciones a patir de los parámetros del
modelo. Ejemplo Brown 2006 cap. 2:

-   VAR(D1)= $\sigma_{11}=\lambda_{11}\psi_{11} + \varepsilon_{1}=.83^{2}(1) + .31 = 1.00$

-   COV(D1,D2)= $\sigma_{21}=\lambda_{11}\psi_{11}\lambda_{21}=(.83)(1)(.84) =.70$

---

.pull-left-narrow[
.content-box-purple[
<br>
# Conceptos y parámetros
<br>
<br>
<br>
<br>
<br>
]
]

.pull-right-wide[
-   **Factores**: variables latentes que están a la base de las
    correlaciones entre los indicadores

-   **Cargas factoriales**: medida estandarizada de asociación (correlación) entre el indicador y la variable latente

-   **Comunalidad**: proporción del indicador que se asocia a factor(es) comun(es)
]
---
class: middle

.pull-left-narrow[
.content-box-yellow[
<br>
# Conceptos y parámetros (2)
<br>
<br>
<br>
]
]

.pull-right-wide[
-   **Varianza única** (uniqueness): 1-comunalidad

-   **Eigenvalues**: medida de proporción de la varianza total
    correspondiente a cada uno de los factor (SS loadings)

-   **Proporción de varianza** explicada por el factor = eigenvalue /
    número de indicadores
    ]

---
class: middle

.pull-left-narrow[
.content-box-blue[
<br>
# Pasos en el análisis
<br>
<br>
<br>
]]

.pull-right-wide[
-   Estimación de matriz de correlaciones

-   Extraccion de factores

-   Decisión sobre número de factores

-   Rotación

-   Interpretación y reporte

-   Obtención de puntajes factoriales
]
---

.center[
  ![:scale 45%](../../files/img/slides/process.png)
]

---
# Supuestos a evaluar

-   Nivel de medición de variables, normalidad (eventualmente test de normalidad multivariado, ej: Shapiro Wilk multivariado)

-   Test de adecuación muestal (KMO)
.medium[
      - varía entre 0 y 1, contrasta si las correlaciones parciales entre las variables son pequeñas.

- valores pequeños (menores a 0.5) indican que los datos no serían adecuados para EFA, ya que las correlaciones entre pares de variables no pueden ser explicadas por otras variables
]

---
# Supuestos a evaluar (2)

-   Nivel de correlaciones de la matriz: test de esfericidad de Bartlett

    -   se utiliza para evaluar la hipótesis que la matriz de
        correlaciones es una matriz identidad (diagonal 1 y bajo la
        diagonal 0)

    -   se busca significación (p $<$ 0.05)ya que se espera que las
        variables estén correlacionadas


---
# Metodos de extracción

-   **Factores principales**

-   **Factores principales iterados**: estima comunalidades iterativamente,
    reemplazandolas en la matriz de correlaciones a partir de las
    comunalidades estimadas desde los factor loadings

-   **Maximum likelihood**: maximiza la posibilidad de que los parametros reproduzcan los datos observados
---
# Instrumentos y criterios de selección del número de factores

-   Criterio de Kaiser: eigenvalues mayores a 1

-   Scree plot (gráfico de sedimentación)

-   **Análisis paralelo**: comparación de eigenvalues de la muestra con eigenvalues de datos aleatorios. Nº apropiado de factores: numero de eigenvalues de los datos reales que son mayores que sus correspondientes eigenvalues de datos aleatorios

---
# Screeplot y análisis paralelo

.center[
  ![:scale 60%](../../files/img/slides/parallel.PNG)
]

---

.pull-left-narrow[
# Tipos de rotación

-   **Ortogonal**: asume que los factores no se encuentran correlacionados

-   **Oblicua**: permite correlación entre factores
]

.pull-right-wide[
.center[
  ![:scale 80%](../../files/img/slides/rotate.PNG)
]
]

---
class: roja
# Resumen

- dimensiones subyacentes = factores

- análisis factorial
  - relación entre indicadores y dimensiones
  - estimación de número de dimensiones probables subyacentes a batería
  - rotación
  - obtención de puntajes factoriales (índices ponderados)

---
class: inverse middle

## .red[Práctica análisis factorial]
[.yellow[encuestas-sociales.netlify.app/resource/05-resource.html]](https://encuestas-sociales.netlify.app//resource/05-resource.html)


---
class: front
.pull-left[
# Encuestas Sociales
## Juan Carlos Castillo
## Sociología FACSO - UChile
## 2do Sem 2022
## [.green[encuestas-sociales.netlify.com]](https://encuestas-sociales.netlify.com)
]


.pull-right[
.right[
<br>
## .yellow[Sesión 11: Análisis factorial]
![:scale 70%](../../files/img/eval-hires.png)

]
]





